
# This will compile all the backend processors
pool:
  name: FA_BuildPool-Prod

variables:
  solution: '**/*.sln'
  buildPlatform: 'Any CPU'
  buildConfiguration: 'Debug'

steps:

# Setup NuGet
- task: NuGetToolInstaller@1
  displayName: 'Use NuGet 5.10.0'
  inputs:
    versionSpec: 5.10.0

# Will setup dotnet tools if not on build server
- task: PowerShell@2
  displayName: 'Setup dotnet tool'
  inputs:
    targetType: 'inline'
    script: 'dotnet tool install -g Amazon.Lambda.Tools'
    errorActionPreference: 'silentlyContinue'
    failOnStderr: false
    ignoreLASTEXITCODE: true

- task: PowerShell@2
  displayName: 'Compile and make Lambda zip file'
  inputs:
    targetType: 'inline'
    script: 'dotnet lambda package -pl Solutions\TransactionsPortal\ReportByTransactionType\Report.TransactionType.Service.Lambda -o $(Build.ArtifactStagingDirectory)\ReportTransactionTypeLambda.zip'

- task: CopyFiles@2
  displayName: 'Copy Postman Scripts'
  inputs:
    SourceFolder: 'Solutions/TransactionsPortal/Tools/Postman'
    contents: '**'
    TargetFolder: '$(Build.ArtifactStagingDirectory)'    

- task: CopyFiles@2
  displayName: 'Copy aws login bat file'
  inputs:
    SourceFolder: 'Solutions/TransactionsPortal/Deployment'
    contents: 'aws-profile-setup-and-login.bat'
    TargetFolder: '$(Build.ArtifactStagingDirectory)'   

- task: PublishBuildArtifacts@1
  displayName: 'Publish Artifact: $(Build.BuildNumber)'
  inputs:
    ArtifactName: '$(Build.BuildNumber)_ReportByTransactionType'
    publishLocation: FilePath
    TargetPath: '\\corp.firstam.com\Apps\SCM\Repo\TeamConnect\TransactionPortal'
